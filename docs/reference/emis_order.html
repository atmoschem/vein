<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Re-order the emission to match specific hours and days — emis_order • vein</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Re-order the emission to match specific hours and days — emis_order"><meta property="og:description" content="Emissions are usually estimated for a year, 24 hours, or one week from monday to sunday (with 168 hours). This depends on the availability of traffic data.
When an air quality simulation is going to be done, they cover
specific periods of time. For instance, WRF Chem emissions files support periods of time,
or two emissions sets for a representative day (0-12z 12-0z). Also a WRF Chem simulation
scan starts a thursday at 00:00 UTC, cover 271 hours of simulations, but hour emissions are in local
time and cover only 168 hours starting on monday. This function tries to transform our emissions
in local time to the desired UTC time, by recycling the local emissions."><meta property="og:image" content="http://atmoschem.github.io/vein/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-2642843-5"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-2642843-5');
</script></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">vein</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.9.92</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/basics.html">Basics for running VEIN</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/atmoschem/vein/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Re-order the emission to match specific hours and days</h1>
    <small class="dont-index">Source: <a href="https://github.com/atmoschem/vein/blob/HEAD/R/emis_order.R" class="external-link"><code>R/emis_order.R</code></a></small>
    <div class="hidden name"><code>emis_order.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Emissions are usually estimated for a year, 24 hours, or one week from monday to sunday (with 168 hours). This depends on the availability of traffic data.
When an air quality simulation is going to be done, they cover
specific periods of time. For instance, WRF Chem emissions files support periods of time,
or two emissions sets for a representative day (0-12z 12-0z). Also a WRF Chem simulation
scan starts a thursday at 00:00 UTC, cover 271 hours of simulations, but hour emissions are in local
time and cover only 168 hours starting on monday. This function tries to transform our emissions
in local time to the desired UTC time, by recycling the local emissions.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">emis_order</span><span class="op">(</span>
  <span class="va">x</span>,
  <span class="va">lt_emissions</span>,
  <span class="va">start_utc_time</span>,
  <span class="va">desired_length</span>,
  tz_lt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/timezones.html" class="external-link">Sys.timezone</a></span><span class="op">(</span><span class="op">)</span>,
  seconds <span class="op">=</span> <span class="fl">0</span>,
  k <span class="op">=</span> <span class="fl">1</span>,
  <span class="va">net</span>,
  verbose <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>x</dt>
<dd><p>one of the following:</p><ul><li><p>Spatial object of class "Spatial". Columns are hourly emissions.</p></li>
<li><p>Spatial Object of class "sf". Columns are hourly emissions.</p></li>
<li><p>"data.frame", "matrix" or "Emissions".</p></li>
</ul><p>In all cases, columns are hourly emissions.</p></dd>


<dt>lt_emissions</dt>
<dd><p>Local time of the emissions at the first hour. It must be
the <strong>before</strong>  time of start_utc_time. For instance, if
start_utc_time is 2020-02-02 00:00, and your emissions starts monday at 00:00,
your lt_emissions must be 2020-01-27 00:00. The argument tz_lt will detect your
current local time zone and do the rest for you.</p></dd>


<dt>start_utc_time</dt>
<dd><p>UTC time for the desired first hour. For instance,
the first hour of the namelist.input for WRF.</p></dd>


<dt>desired_length</dt>
<dd><p>Integer; length to recycle or subset local emissions. For instance, the length
of the WRF Chem simulations, states at namelist.input.</p></dd>


<dt>tz_lt</dt>
<dd><p>Character, Time zone of the local emissions. Default value is derived from
Sys.timezone(), however, it accepts any other. If you enter a wrong tz, this function will show
you a menu to choose one of the 697 time zones available.</p></dd>


<dt>seconds</dt>
<dd><p>Number of seconds to add</p></dd>


<dt>k</dt>
<dd><p>Numeric, factor.</p></dd>


<dt>net</dt>
<dd><p>SpatialLinesDataFrame or Spatial Feature of "LINESTRING".</p></dd>


<dt>verbose</dt>
<dd><p>Logical, to show more information, default is TRUE.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>sf or data.frame</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="GriddedEmissionsArray.html">GriddedEmissionsArray</a></code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in"><span class="co">#do not run</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">pc_profile</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">fe2015</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">fkm</span><span class="op">)</span></span>
<span class="r-in"><span class="va">PC_G</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">33491</span>,<span class="fl">22340</span>,<span class="fl">24818</span>,<span class="fl">31808</span>,<span class="fl">46458</span>,<span class="fl">28574</span>,<span class="fl">24856</span>,<span class="fl">28972</span>,<span class="fl">37818</span>,<span class="fl">49050</span>,<span class="fl">87923</span>,</span>
<span class="r-in">          <span class="fl">133833</span>,<span class="fl">138441</span>,<span class="fl">142682</span>,<span class="fl">171029</span>,<span class="fl">151048</span>,<span class="fl">115228</span>,<span class="fl">98664</span>,<span class="fl">126444</span>,<span class="fl">101027</span>,</span>
<span class="r-in">          <span class="fl">84771</span>,<span class="fl">55864</span>,<span class="fl">36306</span>,<span class="fl">21079</span>,<span class="fl">20138</span>,<span class="fl">17439</span>, <span class="fl">7854</span>,<span class="fl">2215</span>,<span class="fl">656</span>,<span class="fl">1262</span>,<span class="fl">476</span>,<span class="fl">512</span>,</span>
<span class="r-in">          <span class="fl">1181</span>, <span class="fl">4991</span>, <span class="fl">3711</span>, <span class="fl">5653</span>, <span class="fl">7039</span>, <span class="fl">5839</span>, <span class="fl">4257</span>,<span class="fl">3824</span>, <span class="fl">3068</span><span class="op">)</span></span>
<span class="r-in"><span class="va">veh</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>PC_G <span class="op">=</span> <span class="va">PC_G</span><span class="op">)</span></span>
<span class="r-in"><span class="va">pc1</span> <span class="op">&lt;-</span> <span class="fu"><a href="my_age.html">my_age</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">net</span><span class="op">$</span><span class="va">ldv</span>, y <span class="op">=</span> <span class="va">PC_G</span>, name <span class="op">=</span> <span class="st">"PC"</span><span class="op">)</span></span>
<span class="r-in"><span class="va">pcw</span> <span class="op">&lt;-</span> <span class="fu"><a href="temp_fact.html">temp_fact</a></span><span class="op">(</span><span class="va">net</span><span class="op">$</span><span class="va">ldv</span><span class="op">+</span><span class="va">net</span><span class="op">$</span><span class="va">hdv</span>, <span class="va">pc_profile</span><span class="op">)</span></span>
<span class="r-in"><span class="va">speed</span> <span class="op">&lt;-</span> <span class="fu"><a href="netspeed.html">netspeed</a></span><span class="op">(</span><span class="va">pcw</span>, <span class="va">net</span><span class="op">$</span><span class="va">ps</span>, <span class="va">net</span><span class="op">$</span><span class="va">ffs</span>, <span class="va">net</span><span class="op">$</span><span class="va">capacity</span>, <span class="va">net</span><span class="op">$</span><span class="va">lkm</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span class="r-in"><span class="va">pckm</span> <span class="op">&lt;-</span> <span class="fu">units</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/units/man/units.html" class="external-link">set_units</a></span><span class="op">(</span><span class="va">fkm</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">24</span><span class="op">)</span>, <span class="st">"km"</span><span class="op">)</span></span>
<span class="r-in"><span class="va">pckma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">pckm</span><span class="op">)</span></span>
<span class="r-in"><span class="va">cod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="emis_det.html">emis_det</a></span><span class="op">(</span>po <span class="op">=</span> <span class="st">"CO"</span>, cc <span class="op">=</span> <span class="fl">1000</span>, eu <span class="op">=</span> <span class="st">"III"</span>, km <span class="op">=</span> <span class="va">pckma</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">11</span><span class="op">]</span><span class="op">)</span></span>
<span class="r-in"><span class="va">cod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="emis_det.html">emis_det</a></span><span class="op">(</span>po <span class="op">=</span> <span class="st">"CO"</span>, cc <span class="op">=</span> <span class="fl">1000</span>, eu <span class="op">=</span> <span class="st">"I"</span>, km <span class="op">=</span> <span class="va">pckma</span><span class="op">[</span><span class="fl">12</span><span class="op">:</span><span class="fl">24</span><span class="op">]</span><span class="op">)</span></span>
<span class="r-in"><span class="co">#vehicles newer than pre-euro</span></span>
<span class="r-in"><span class="va">co1</span> <span class="op">&lt;-</span> <span class="va">fe2015</span><span class="op">[</span><span class="va">fe2015</span><span class="op">$</span><span class="va">Pollutant</span><span class="op">==</span><span class="st">"CO"</span>, <span class="op">]</span> <span class="co">#24 obs!!!</span></span>
<span class="r-in"><span class="va">cod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">co1</span><span class="op">$</span><span class="va">PC_G</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">24</span><span class="op">]</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">cod1</span>,<span class="va">cod2</span><span class="op">)</span>,<span class="va">co1</span><span class="op">$</span><span class="va">PC_G</span><span class="op">[</span><span class="fl">25</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">co1</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span class="r-in"><span class="va">lef</span> <span class="op">&lt;-</span> <span class="fu"><a href="ef_ldv_scaled.html">ef_ldv_scaled</a></span><span class="op">(</span><span class="va">co1</span>, <span class="va">cod</span>, v <span class="op">=</span> <span class="st">"PC"</span>, t <span class="op">=</span> <span class="st">"4S"</span>, cc <span class="op">=</span> <span class="st">"&lt;=1400"</span>,</span>
<span class="r-in">                     f <span class="op">=</span> <span class="st">"G"</span>,p <span class="op">=</span> <span class="st">"CO"</span>, eu<span class="op">=</span><span class="va">co1</span><span class="op">$</span><span class="va">Euro_LDV</span><span class="op">)</span></span>
<span class="r-in"><span class="va">E_CO</span> <span class="op">&lt;-</span> <span class="fu"><a href="emis.html">emis</a></span><span class="op">(</span>veh <span class="op">=</span> <span class="va">pc1</span>,lkm <span class="op">=</span> <span class="va">net</span><span class="op">$</span><span class="va">lkm</span>, ef <span class="op">=</span> <span class="va">lef</span>, speed <span class="op">=</span> <span class="va">speed</span>, agemax <span class="op">=</span> <span class="fl">41</span>,</span>
<span class="r-in">              profile <span class="op">=</span> <span class="va">pc_profile</span>, simplify <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">E_CO</span><span class="op">)</span></span>
<span class="r-in"><span class="va">E_CO_STREETS</span> <span class="op">&lt;-</span> <span class="fu"><a href="emis_post.html">emis_post</a></span><span class="op">(</span>arra <span class="op">=</span> <span class="va">E_CO</span>, pollutant <span class="op">=</span> <span class="st">"CO"</span>, by <span class="op">=</span> <span class="st">"streets"</span>, net <span class="op">=</span> <span class="va">net</span><span class="op">)</span></span>
<span class="r-in"><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="make_grid.html">make_grid</a></span><span class="op">(</span><span class="va">net</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">102.47</span><span class="op">/</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">102.47</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span> <span class="co">#500m in degrees</span></span>
<span class="r-in"><span class="va">E_CO_g</span> <span class="op">&lt;-</span> <span class="fu"><a href="emis_grid.html">emis_grid</a></span><span class="op">(</span>spobj <span class="op">=</span> <span class="va">E_CO_STREETS</span>, g <span class="op">=</span> <span class="va">g</span>, sr<span class="op">=</span> <span class="fl">31983</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">E_CO_g</span><span class="op">)</span> <span class="co">#class sf</span></span>
<span class="r-in"><span class="va">gr</span> <span class="op">&lt;-</span> <span class="fu"><a href="GriddedEmissionsArray.html">GriddedEmissionsArray</a></span><span class="op">(</span><span class="va">E_CO_g</span>, rows <span class="op">=</span> <span class="fl">19</span>, cols <span class="op">=</span> <span class="fl">23</span>, times <span class="op">=</span> <span class="fl">168</span>, <span class="cn">T</span><span class="op">)</span></span>
<span class="r-in"><span class="va">wCO</span> <span class="op">&lt;-</span> <span class="fu">emis_order</span><span class="op">(</span>x <span class="op">=</span> <span class="va">E_CO_g</span>,</span>
<span class="r-in">                   lt_emissions <span class="op">=</span> <span class="st">"2020-02-19 00:00"</span>,</span>
<span class="r-in">                   start_utc_time <span class="op">=</span> <span class="st">"2020-02-20 00:00"</span>,</span>
<span class="r-in">                   desired_length <span class="op">=</span> <span class="fl">241</span><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-in"></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by <a href="https://ibarraespinosa.github.io" class="external-link">Sergio Ibarra-Espinosa</a>.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer></div>

  


  

  </body></html>

