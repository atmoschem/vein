<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Allocate emissions gridded emissions into streets (grid to emis street) — grid_emis • vein</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Allocate emissions gridded emissions into streets (grid to emis street) — grid_emis" />
<meta property="og:description" content="grid_emis it is sort of the opposite of
emis_grid. It allocates gridded emissions into streets.
This function applies emis_dist into each grid cell using
lapply. This function is in development and pull request are welcome." />
<meta property="og:image" content="http://atmoschem.github.io/vein/logo.png" />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-2642843-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-2642843-5');
</script>


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">vein</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.8.8</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Allocate emissions gridded emissions into streets (grid to emis street)</h1>
    
    <div class="hidden name"><code>grid_emis.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>grid_emis</code> it is sort of the opposite of
<code><a href='emis_grid.html'>emis_grid</a></code>. It allocates gridded emissions into streets.
This function applies <code><a href='emis_dist.html'>emis_dist</a></code> into each grid cell using
lapply. This function is in development and pull request are welcome.</p>
    </div>

    <pre class="usage"><span class='fu'>grid_emis</span>(<span class='no'>spobj</span>, <span class='no'>g</span>, <span class='kw'>top_down</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='no'>sr</span>, <span class='no'>pro</span>, <span class='no'>char</span>, <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>spobj</th>
      <td><p>A spatial dataframe of class "sp" or "sf". When class is "sp"
it is transformed to "sf".</p></td>
    </tr>
    <tr>
      <th>g</th>
      <td><p>A grid with class "SpatialPolygonsDataFrame" or "sf". This grid
includes the total emissions with the column "emission". If profile is going
to be used, the column 'emission' must include the sum of the emissions
for each profile. For instance, if profile covers the hourly emissions,
the column 'emission' bust be the sum of the hourly emissions.</p></td>
    </tr>
    <tr>
      <th>top_down</th>
      <td><p>Logical; requires emissions named `emissions` and allows
to apply profile factors. If your data is hourly emissions or a a spatial
grid with several emissions at different hours, being each hour a column,
it is better to use top_down = FALSE. In this way all the hourly emissions
are considered, however, eah hourly emissions has to have the name "V" and the
number of the hour like "V1"</p></td>
    </tr>
    <tr>
      <th>sr</th>
      <td><p>Spatial reference e.g: 31983. It is required if spobj and g are
not projected. Please, see http://spatialreference.org/.</p></td>
    </tr>
    <tr>
      <th>pro</th>
      <td><p>Numeric, Matrix or data-frame profiles, for instance, pc_profile.</p></td>
    </tr>
    <tr>
      <th>char</th>
      <td><p>Character, name of the first letter of hourly emissions. New variables in R
start with letter "V", for your hourly emissions might start with letter "h". This option
applies when top_down is FALSE. For instance, if your hourly emissions are: "h1", "h2",
"h3"... `char`` can be "h"</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>Logical; to show more info.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p><strong>Your gridded emissions might have flux units (mass / area / time(implicit))</strong>
<strong>You must multiply your emissions with the area to return to the original units.</strong></p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>{
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>net</span>)
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>pc_profile</span>)
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>fkm</span>)
<span class='no'>PC_G</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>33491</span>,<span class='fl'>22340</span>,<span class='fl'>24818</span>,<span class='fl'>31808</span>,<span class='fl'>46458</span>,<span class='fl'>28574</span>,<span class='fl'>24856</span>,<span class='fl'>28972</span>,<span class='fl'>37818</span>,<span class='fl'>49050</span>,<span class='fl'>87923</span>,
<span class='fl'>133833</span>,<span class='fl'>138441</span>,<span class='fl'>142682</span>,<span class='fl'>171029</span>,<span class='fl'>151048</span>,<span class='fl'>115228</span>,<span class='fl'>98664</span>,<span class='fl'>126444</span>,<span class='fl'>101027</span>,
       <span class='fl'>84771</span>,<span class='fl'>55864</span>,<span class='fl'>36306</span>,<span class='fl'>21079</span>,<span class='fl'>20138</span>,<span class='fl'>17439</span>, <span class='fl'>7854</span>,<span class='fl'>2215</span>,<span class='fl'>656</span>,<span class='fl'>1262</span>,<span class='fl'>476</span>,<span class='fl'>512</span>,
<span class='fl'>1181</span>, <span class='fl'>4991</span>, <span class='fl'>3711</span>, <span class='fl'>5653</span>, <span class='fl'>7039</span>, <span class='fl'>5839</span>, <span class='fl'>4257</span>,<span class='fl'>3824</span>, <span class='fl'>3068</span>)
<span class='no'>pc1</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='my_age.html'>my_age</a></span>(<span class='kw'>x</span> <span class='kw'>=</span> <span class='no'>net</span>$<span class='no'>ldv</span>, <span class='kw'>y</span> <span class='kw'>=</span> <span class='no'>PC_G</span>, <span class='kw'>name</span> <span class='kw'>=</span> <span class='st'>"PC"</span>)
<span class='co'># Estimation for morning rush hour and local emission factors</span>
<span class='no'>lef</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='EmissionFactorsList.html'>EmissionFactorsList</a></span>(<span class='fu'><a href='ef_cetesb.html'>ef_cetesb</a></span>(<span class='st'>"CO"</span>, <span class='st'>"PC_G"</span>))
<span class='no'>E_CO</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='emis.html'>emis</a></span>(<span class='kw'>veh</span> <span class='kw'>=</span> <span class='no'>pc1</span>,<span class='kw'>lkm</span> <span class='kw'>=</span> <span class='no'>net</span>$<span class='no'>lkm</span>, <span class='kw'>ef</span> <span class='kw'>=</span> <span class='no'>lef</span>,
            <span class='kw'>profile</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>speed</span> <span class='kw'>=</span> <span class='fu'><a href='Speed.html'>Speed</a></span>(<span class='fl'>1</span>))
<span class='no'>E_CO_STREETS</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='emis_post.html'>emis_post</a></span>(<span class='kw'>arra</span> <span class='kw'>=</span> <span class='no'>E_CO</span>, <span class='kw'>by</span> <span class='kw'>=</span> <span class='st'>"streets"</span>, <span class='kw'>net</span> <span class='kw'>=</span> <span class='no'>net</span>)

<span class='no'>g</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='make_grid.html'>make_grid</a></span>(<span class='no'>net</span>, <span class='fl'>1</span>/<span class='fl'>102.47</span>/<span class='fl'>2</span>) <span class='co'>#500m in degrees</span>

<span class='no'>gCO</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='emis_grid.html'>emis_grid</a></span>(<span class='kw'>spobj</span> <span class='kw'>=</span> <span class='no'>E_CO_STREETS</span>, <span class='kw'>g</span> <span class='kw'>=</span> <span class='no'>g</span>)
<span class='no'>gCO</span>$<span class='no'>emission</span> <span class='kw'>&lt;-</span> <span class='no'>gCO</span>$<span class='no'>V1</span>
<span class='no'>area</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>sf</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/sf/man/geos_measures.html'>st_area</a></span>(<span class='no'>gCO</span>)
<span class='no'>area</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>units</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/units/man/set_units.html'>set_units</a></span>(<span class='no'>area</span>, <span class='st'>"km^2"</span>) <span class='co'>#Check units!</span>
<span class='no'>gCO</span>$<span class='no'>emission</span> <span class='kw'>&lt;-</span> <span class='no'>gCO</span>$<span class='no'>emission</span>*<span class='no'>area</span>
<span class='co'>#</span>
<span class='kw'>if</span> (<span class='fl'>FALSE</span>) {
<span class='co'>#do not run</span>
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>osmdata</span>)
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>sf</span>)
<span class='no'>osm</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://docs.ropensci.org/osmdata/reference/osmdata_sf.html'>osmdata_sf</a></span>(
<span class='fu'><a href='https://docs.ropensci.org/osmdata/reference/add_osm_feature.html'>add_osm_feature</a></span>(
<span class='fu'><a href='https://docs.ropensci.org/osmdata/reference/opq.html'>opq</a></span>(<span class='kw'>bbox</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/sf/man/st_bbox.html'>st_bbox</a></span>(<span class='no'>gCO</span>)),
<span class='kw'>key</span> <span class='kw'>=</span> <span class='st'>'highway'</span>))$<span class='no'>osm_lines</span>[, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"highway"</span>)]
<span class='no'>st</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"motorway"</span>, <span class='st'>"motorway_link"</span>, <span class='st'>"trunk"</span>, <span class='st'>"trunk_link"</span>,
<span class='st'>"primary"</span>, <span class='st'>"primary_link"</span>, <span class='st'>"secondary"</span>, <span class='st'>"secondary_link"</span>,
<span class='st'>"tertiary"</span>, <span class='st'>"tertiary_link"</span>)
<span class='no'>osm</span> <span class='kw'>&lt;-</span> <span class='no'>osm</span>[<span class='no'>osm</span>$<span class='no'>highway</span> <span class='kw'>%in%</span> <span class='no'>st</span>, ]
<span class='fu'><a href='https://rdrr.io/pkg/sf/man/plot.html'>plot</a></span>(<span class='no'>osm</span>, <span class='kw'>axes</span> <span class='kw'>=</span> <span class='no'>T</span>)
<span class='co'># top_down requires name `emissions` into gCO`</span>
<span class='no'>xnet</span> <span class='kw'>&lt;-</span> <span class='fu'>grid_emis</span>(<span class='no'>osm</span>, <span class='no'>gCO</span>, <span class='kw'>top_down</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)
<span class='fu'><a href='https://rdrr.io/pkg/sf/man/plot.html'>plot</a></span>(<span class='no'>xnet</span>, <span class='kw'>axes</span> <span class='kw'>=</span> <span class='no'>T</span>)
<span class='co'># bottom_up requires that emissions are named `V` plus the hour like `V1`</span>
<span class='no'>xnet</span> <span class='kw'>&lt;-</span> <span class='fu'>grid_emis</span>(<span class='no'>osm</span>, <span class='no'>gCO</span>,<span class='kw'>top_down</span><span class='kw'>=</span> <span class='fl'>FALSE</span>)
<span class='fu'><a href='https://rdrr.io/pkg/sf/man/plot.html'>plot</a></span>(<span class='no'>xnet</span>[<span class='st'>"V1"</span>], <span class='kw'>axes</span> <span class='kw'>=</span> <span class='no'>T</span>)
}
}</div><div class='output co'>#&gt; Number of lon points: 23
#&gt; Number of lat points: 19
#&gt; </div><div class='output co'>#&gt; <span class='message'>Your units are: </span></div><div class='output co'>#&gt; <span class='message'>g</span></div><div class='output co'>#&gt; Sum of street emissions 2543814.05
#&gt; Sum of gridded emissions 2543814.05</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      <li><a href="#note">Note</a></li>
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by <a href='https://ibarraespinosa.github.io'>Sergio Ibarra-Espinosa</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


